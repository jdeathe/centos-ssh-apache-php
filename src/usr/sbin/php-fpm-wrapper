#!/usr/bin/env bash

set -e

function main ()
{
	local -r bin="/usr/sbin/php-fpm"
	local -r lock_file="/var/lock/subsys/httpd-bootstrap"
	local -r nice="/bin/nice"
	local -r niceness="10"
	local -r options="-g /var/run/php-fpm/php-fpm.pid -F"

	while true
	do
		sleep 0.1
		if [[ ! -e ${lock_file} ]]
		then
			break
		fi
	done

	exec ${nice} \
		-n ${niceness} \
		${bin} \
		${options}
}

main "${@}"
